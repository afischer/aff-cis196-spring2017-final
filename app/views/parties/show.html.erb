<p id="notice"><%= notice %></p>

<div class="row">
  <div class="col-xs-12">
    <h1>
      <%= @party.name %>
      <% if current_user.dj?(@party) %>
        <small><%= link_to '', edit_party_path(@party), :class => "glyphicon glyphicon-pencil", 'data-toggle': 'tooltip', 'data-placement': 'top', 'title': 'Rename Party' %></small>
      <% end %>
    </h1>
  </div>
</div>

<div class="row">
  <div class="col-sm-4">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">
          Now Playing:
          <%if @party.current_song.nil? %>
            Silence.
          <% else %>
            <strong><%= @party.current_song.title %></strong> by
            <%= @party.current_song.artist %>
          <% end %>
        </h3>
      </div>
      <div class="panel-body">
        <% unless @party.current_song.nil? %>
          <img src="<%= @party.current_song.album_art %>" class="img img-responsive">
          <% if @party.current_song.source == 'Spotify' %>
            <iframe src="https://embed.spotify.com/?uri=<%= @party.current_song.uri %>&theme=white" width="100%" height="80" frameborder="0" allowtransparency="true"></iframe></br>
          <% end %>
          <i>Via <%= @party.current_song.source %></i> <br>
          <strong>Song: </strong> <%= @party.current_song.title %> <br>
          <strong>Artist: </strong> <%= @party.current_song.artist %> <br>
          <strong>Album: </strong> <%= @party.current_song.album %> <br>
        <% end %>
      </div>
    </div>
  </div>

  <div class="col-md-5">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Upcoming Playlist</h3>
      </div>

      <ul class="list-group">
        <%= render partial: "playlist", locals: {songs: @party.songs} %>
        <li class="list-group-item">
          <%= render 'songs/form' %>
        </li>
      </ul>
    </div>
  </div>
  <h1 id="count"></h1>

  <div class="col-md-3">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Listeners</h3>
      </div>
      <ul class="list-group">
        <% @party.users.each do |user| %>
          <li class="list-group-item">
            <% user = User.find(user.id) %>
            <%= user.nickname %>
            <% if user.dj?(@party) %>
              <span class="glyphicon glyphicon-cd" data-toggle="tooltip" data-placement="right" title="<%= user.nickname %> is the DJ"></span>
            <% end %>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
</div>
